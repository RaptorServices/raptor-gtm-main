# Main script for Google Tag manager

Script template for Google Tag manager. Should be put on all pages at the pageview event

### Prerequisites
- A Raptor CustomerId. You will find your customerId in the Raptor controlpanel. To gain access to Raptor, please contact support@raptorsmartadvisor.com
- A website using Google Tagmanager and Enhanced Ecommerce

>**NB:** The Raptor tags will only work on a website, which has implemented Enhanced Ecommerce (UA). Please refer to Googles documentation, before implementing the following tags.[Enhanced Ecommerce Documentation](https://developers.google.com/tag-manager/enhanced-ecommerce)
<

### Step by step guide for implementing the Raptor tags in GTM


- Import the template "Raptor main" from the template gallery
    - Go to "Templates" --> Search Gallery, and search for "Raptor"

- Import the template "Raptor enhanced ecommerce" from the template gallery

- Set up a tag using the "Raptor main" template
    - Go to "Tags" --> Create new --> "Tag Configuration" and select "Raptor main" from the list
    - Set the trigger to fire at all pages AFTER cookie consent. Raptor main will start to fire cookies as soon as it is loaded.
    - Fill out your customerId in the customerId Field 
- Set up a tag using the "Raptor enhanced ecommerce" template
    - Set the tag to fire on the following events:
        - Product detail
        - Add to basket
        - Remove from basket
        - Purchase
        - Product click
- Add the extra fields to the datalayer which is described below


### Extra fields needed in the datalayer

#### ecommerce.categoryPath

When tracking a product, we need to know the path from the top category level and down to the product category. We use the following syntax for this:

```
categoryId1#categoryName1;categoryId2#categoryName2;categoryId3#categoryName3;
```
Example:

```javascript
{
  ecommerce: {
    detail: {
      actionField: {list: 'Apparel Gallery'},
      products: [
        {
          name: 'Apple Macbook Pro',
          id: '12345',
          price: '12995',
          brand: 'Apple',
          category: 'Apple',
          variant: 'Gray',
          quantity: 1
        }
      ]
    },
    categoryPath: '123#Computer;234#Laptops;345#Apple'
  }
}
```




#### ecommerce.basketContent & ecommerce.basketId
When firing basket events (addToBasket and removeFromBasket), add the following parameters to the ecommerce object:


**basketContent** is a commaseparated list of the productids currently in the basket.

**basketId** is the id of the basket, typically generated by the backend of the ecommerce system

Example:
```javascript
{
  
  event: 'addToBasket',
  ecommerce: {
    add: {
      products: [
        {
          name: 'Apple Macbook Pro',
          id: '12345',
          price: '12995',
          brand: 'Apple',
          category: 'Apple',
          variant: 'Gray',
          quantity: 1
        }
      ]
    },
    basketContent: '12345,23456',
    basketId: '5442883c-4f7e-4394-be91-74cec47c05a7'
  }
}
```

#### ecommerce.raptorModule
When clicking a raptor module on the website, add a variable containing the name of the clicked module

Example:
```javascript
{
  
  event: 'productClick',
  ecommerce: {
    click: {
      products: [
        {
          name: 'Apple Macbook Pro',
          id: '12345',
          price: '12995',
          brand: 'Apple',
          category: 'Apple',
          variant: 'Gray',
          quantity: 1
        }
      ]
    },
    raptorModule: 'GetSimilarItems',
  }
}
```
Set raptorModule = null when not clicking a RaptorModule

